)
## Working Directory
setwd(githubdir)
setwd("/Users/iasmingoes/Library/CloudStorage/Dropbox/twitter_uk151719/")
library(tidyverse)
library(haven)
## Load the data
df_bnes_panel <- read_dta("data/bnes_survey/BES2024_W29_Panel_v29.1.dta.zip") |>
zap_labels() |>
filter(wave4 == 1 | wave5 == 1 | wave6 == 1 | wave11 == 1 | wave12 == 1 | wave13 == 1 | wave17 == 1 | wave18 == 1 | wave19 == 1) |>
dplyr::select(#eligible,
id, waves_taken,
starts_with("oslaua"),
starts_with("pconW"), starts_with("new_pconW"), # Area IDs
starts_with("countryW"),
starts_with("CampaignDay"),
countryOfBirth2W27, starts_with("workingStatus"), starts_with("anyUni"), starts_with("p_education"),
starts_with("p_edlevel"), starts_with("p_edlevelUni"), starts_with("p_ethnicity"), starts_with("p_gross_household"),
starts_with("p_gross_personal"), starts_with("p_hh_size"), starts_with("p_hh_children"), starts_with("p_housing"),
starts_with("p_marital"), starts_with("p_paper_read"), starts_with("p_work_stat"),
p_past_vote_2005, p_past_vote_2010, p_past_vote_2015, p_past_vote_2017,
p_turnout_2005, p_turnout_2010, p_turnout_2015, p_turnout_2017,
gender,
starts_with("miiW"), starts_with("mii_catW"), starts_with("bestOnMII"), starts_with("handleMII"),
starts_with("turnoutUKGeneral"),  starts_with("genElecTurnoutRetro"),  starts_with("generalElectionVoteRetro"),
starts_with("decidedVote"),  starts_with("generalElectionVote"), #(in postelection waves this is retro)
starts_with("reasonForVote"), #(postelection),
starts_with("generalElecCertainty"), #You said that you would be most likely to vote for $generalElectionVotetext in a General Election. How certain are you that you would vote for this party?
starts_with("debateOneWatch"), #- W5W8W12W18,starts_with("partyIdW"),  starts_with("partyIdSqueezeW"),  starts_with("partyIdStrengthW"),
#pidWeThey, pidInterestedOthers, pidCriticiseParty, pidCommonParty, pidRuinDay, pidConnected, pidMyParty, pidPraiseGood,
starts_with("electionInterestW"), starts_with("polAttentionW"), starts_with("discussPolDaysW"), starts_with("polKnow"),
starts_with("partyMemberW"), starts_with("partyMemberNow"),
starts_with("twitter"), starts_with("fb"),
starts_with("infoSourceInternet"), # (Internet (not including online newspapers))
starts_with("trustMPsW"),
starts_with("lr"), #lr_scale, lr1, lr2, lr3, lr4,lr5,
starts_with("al_scaleW"),
starts_with("populism"),
starts_with("like"),
starts_with("ptv"),
starts_with("leftRight"),
starts_with("lr"),
contains("Priorities"),
contains("United"),
starts_with("competent"),
starts_with("integrity"),
contains("sharedContentOnline"),
starts_with("econPersonalRetro"),  starts_with("econGenRetro"),
#euID, goodTimePurchase, achieveReduceImmig, risksEcon,
#changeEconomy, changeNHS, changeEducation, changeCostLive, changeImmig, changeCrime, changeEconomyLab, changeNHSLab, changeEducationLab, changeCostLiveLab, changeImmigLab, changeCrimeLab,
#redistSelf, redistCon, redistLab, redistLD, redistUKIP, redistSNP, redistPC, redistGreen, redistTIG, redistBrexit,
#immigself, immigCon, immigLab, immigLD, immigSNP, immigPC, immigUKIP, immigGreen, immigTIG, immigBrexit,
#atDemUK, satDemScot, satDemWales, satDemEng, welfarePreference,
starts_with("bestLeaderCampaign"), # W5W6
starts_with("worstLeaderCampaign"), # W5W6
#campaignTone, # W5W6W12W18 In their campaigns political parties can focus on criticising the policies and personalities of other parties, or they can focus on putting forward their own policies and personalities. What is, in your view, the focus of the campaign of each of the following parties?
#partyEmotions, #W4W6,
)
# For lower RAM:
#write_csv(df_bnes_panel,gzfile("data/df_bnes_panel_reduced.csv.gz"))
df_bnes_panel <- read_csv("data/df_bnes_panel_reduced.csv.gz")
View(df_bnes_panel)
load("/Users/iasmingoes/Library/CloudStorage/Dropbox/Book ideas/WB_paper/data/dynamic_model.RData")
top_words(dynamic_out)
# to load data
library(rio)
# to manipulate data
library(tidyverse)
# to manipulate text data
library(quanteda)
# to run keyword assisted automated topic model
library(keyATM)
# to disable scientific notation
options(scipen=999)
# set wd
setwd("~/Dropbox/Book ideas/WB_paper/")
top_words(dynamic_out)
###### OTHERS
fig_timetrend1 <- plot_timetrend(dynamic_out, time_index_label = abstracts$year, xlab = "Year")
fig_timetrend$values <- fig_timetrend1$values %>%
mutate(Topic = case_when(
Topic =="1_Extractives" ~ "Topic 1: Extractives",
Topic =="2_Renewables" ~ "Topic 2: Renewables",
Topic =="3_Climate" ~ "Topic 3: Climate",
Topic =="4_Health" ~ "Topic 4: Health",
Topic =="Other_1" ~ "Topic 5: Social Reform",
Topic =="Other_2" ~ "Topic 6: Infrastructure",
Topic =="Other_3" ~ "Topic 7: Urban and Rural Development",
Topic =="Other_4" ~ "Topic 8: Nutrition",
Topic =="Other_5" ~ "Topic 9: Public Management",
Topic =="Other_6" ~ "Topic 10: Education",
Topic =="Other_7" ~ "Topic 11: Statistical Capacity",
Topic =="Other_8" ~ "Topic 12: Private Sector",
Topic =="Other_9" ~ "Topic 13: Fiscal Reforms",
Topic =="Other_10" ~ "Topic 14: Credit Policies",
.default = Topic)
) %>%
mutate(Topic = factor(Topic, levels = c(
"Topic 1: Extractives",
"Topic 2: Renewables",
"Topic 3: Climate",
"Topic 4: Health",
"Topic 5: Social Reform",
"Topic 6: Infrastructure",
"Topic 7: Urban and Rural Development",
"Topic 8: Nutrition",
"Topic 9: Public Management",
"Topic 10: Education",
"Topic 11: Statistical Capacity",
"Topic 12: Private Sector",
"Topic 13: Fiscal Reforms",
"Topic 14: Credit Policies"
)))
fig_timetrend <- plot_timetrend(dynamic_out, time_index_label = abstracts$year, xlab = "Year")
fig_timetrend$values <- fig_timetrend1$values %>%
mutate(Topic = case_when(
Topic =="1_Extractives" ~ "Topic 1: Extractives",
Topic =="2_Renewables" ~ "Topic 2: Renewables",
Topic =="3_Climate" ~ "Topic 3: Climate",
Topic =="4_Health" ~ "Topic 4: Health",
Topic =="Other_1" ~ "Topic 5: Social Reform",
Topic =="Other_2" ~ "Topic 6: Infrastructure",
Topic =="Other_3" ~ "Topic 7: Urban and Rural Development",
Topic =="Other_4" ~ "Topic 8: Nutrition",
Topic =="Other_5" ~ "Topic 9: Public Management",
Topic =="Other_6" ~ "Topic 10: Education",
Topic =="Other_7" ~ "Topic 11: Statistical Capacity",
Topic =="Other_8" ~ "Topic 12: Private Sector",
Topic =="Other_9" ~ "Topic 13: Fiscal Reforms",
Topic =="Other_10" ~ "Topic 14: Credit Policies",
.default = Topic)
) %>%
mutate(Topic = factor(Topic, levels = c(
"Topic 1: Extractives",
"Topic 2: Renewables",
"Topic 3: Climate",
"Topic 4: Health",
"Topic 5: Social Reform",
"Topic 6: Infrastructure",
"Topic 7: Urban and Rural Development",
"Topic 8: Nutrition",
"Topic 9: Public Management",
"Topic 10: Education",
"Topic 11: Statistical Capacity",
"Topic 12: Private Sector",
"Topic 13: Fiscal Reforms",
"Topic 14: Credit Policies"
)))
ggplot(fig_timetrend$values, aes(x = time_index, y = Point)) + geom_line(linewidth = 1, color = "#0f00b3") + facet_wrap("Topic", nrow = 5) +
geom_ribbon(aes(ymin = Lower, ymax = Upper), fill = "#9e9e9e", alpha = 0.4) +
scale_y_continuous(expand = c(0, 0), limits = c(0, NA)) +
theme_classic() + theme(strip.text = element_text(face = "bold")) +
annotate('rect', xmin=2020, xmax=Inf, ymin=0, ymax=Inf, alpha=.2, fill='grey') +
ylab(expression("Mean of " * theta)) + xlab("Year")
?plot_timetrend
fig_timetrend <- plot_timetrend(dynamic_out, show_topic = c(1:14), time_index_label = abstracts$year, xlab = "Year")
fig_timetrend$values <- fig_timetrend1$values %>%
mutate(Topic = case_when(
Topic =="1_Extractives" ~ "Topic 1: Extractives",
Topic =="2_Renewables" ~ "Topic 2: Renewables",
Topic =="3_Climate" ~ "Topic 3: Climate",
Topic =="4_Health" ~ "Topic 4: Health",
Topic =="Other_1" ~ "Topic 5: Social Reform",
Topic =="Other_2" ~ "Topic 6: Infrastructure",
Topic =="Other_3" ~ "Topic 7: Urban and Rural Development",
Topic =="Other_4" ~ "Topic 8: Nutrition",
Topic =="Other_5" ~ "Topic 9: Public Management",
Topic =="Other_6" ~ "Topic 10: Education",
Topic =="Other_7" ~ "Topic 11: Statistical Capacity",
Topic =="Other_8" ~ "Topic 12: Private Sector",
Topic =="Other_9" ~ "Topic 13: Fiscal Reforms",
Topic =="Other_10" ~ "Topic 14: Credit Policies",
.default = Topic)
) %>%
mutate(Topic = factor(Topic, levels = c(
"Topic 1: Extractives",
"Topic 2: Renewables",
"Topic 3: Climate",
"Topic 4: Health",
"Topic 5: Social Reform",
"Topic 6: Infrastructure",
"Topic 7: Urban and Rural Development",
"Topic 8: Nutrition",
"Topic 9: Public Management",
"Topic 10: Education",
"Topic 11: Statistical Capacity",
"Topic 12: Private Sector",
"Topic 13: Fiscal Reforms",
"Topic 14: Credit Policies"
)))
ggplot(fig_timetrend$values, aes(x = time_index, y = Point)) + geom_line(linewidth = 1, color = "#0f00b3") + facet_wrap("Topic", nrow = 5) +
geom_ribbon(aes(ymin = Lower, ymax = Upper), fill = "#9e9e9e", alpha = 0.4) +
scale_y_continuous(expand = c(0, 0), limits = c(0, NA)) +
theme_classic() + theme(strip.text = element_text(face = "bold")) +
annotate('rect', xmin=2020, xmax=Inf, ymin=0, ymax=Inf, alpha=.2, fill='grey') +
ylab(expression("Mean of " * theta)) + xlab("Year")
ggplot(fig_timetrend$values, aes(x = time_index, y = Point)) + geom_line(linewidth = 1, color = "#0f00b3") + facet_wrap("Topic") +
geom_ribbon(aes(ymin = Lower, ymax = Upper), fill = "#9e9e9e", alpha = 0.4) +
scale_y_continuous(expand = c(0, 0), limits = c(0, NA)) +
theme_classic() + theme(strip.text = element_text(face = "bold")) +
annotate('rect', xmin=2020, xmax=Inf, ymin=0, ymax=Inf, alpha=.2, fill='grey') +
ylab(expression("Mean of " * theta)) + xlab("Year")
fig_timetrend
fig_timetrend <- plot_timetrend(dynamic_out, time_index_label = abstracts$year, xlab = "Year")
fig_timetrend$values <- fig_timetrend$values %>%
mutate(Topic = case_when(
Topic =="1_Extractives" ~ "Topic 1: Extractives",
Topic =="2_Renewables" ~ "Topic 2: Renewables",
Topic =="3_Climate" ~ "Topic 3: Climate",
Topic =="4_Health" ~ "Topic 4: Health",
Topic =="Other_1" ~ "Topic 5: Social Reform",
Topic =="Other_2" ~ "Topic 6: Infrastructure",
Topic =="Other_3" ~ "Topic 7: Urban and Rural Development",
Topic =="Other_4" ~ "Topic 8: Nutrition",
Topic =="Other_5" ~ "Topic 9: Public Management",
Topic =="Other_6" ~ "Topic 10: Education",
Topic =="Other_7" ~ "Topic 11: Statistical Capacity",
Topic =="Other_8" ~ "Topic 12: Private Sector",
Topic =="Other_9" ~ "Topic 13: Fiscal Reforms",
Topic =="Other_10" ~ "Topic 14: Credit Policies",
.default = Topic)
) %>%
mutate(Topic = factor(Topic, levels = c(
"Topic 1: Extractives",
"Topic 2: Renewables",
"Topic 3: Climate",
"Topic 4: Health",
"Topic 5: Social Reform",
"Topic 6: Infrastructure",
"Topic 7: Urban and Rural Development",
"Topic 8: Nutrition",
"Topic 9: Public Management",
"Topic 10: Education",
"Topic 11: Statistical Capacity",
"Topic 12: Private Sector",
"Topic 13: Fiscal Reforms",
"Topic 14: Credit Policies"
)))
ggplot(fig_timetrend$values, aes(x = time_index, y = Point)) + geom_line(linewidth = 1, color = "#0f00b3") + facet_wrap("Topic", nrow = 5) +
geom_ribbon(aes(ymin = Lower, ymax = Upper), fill = "#9e9e9e", alpha = 0.4) +
scale_y_continuous(expand = c(0, 0), limits = c(0, NA)) +
theme_classic() + theme(strip.text = element_text(face = "bold")) +
annotate('rect', xmin=2020, xmax=Inf, ymin=0, ymax=Inf, alpha=.2, fill='grey') +
ylab(expression("Mean of " * theta)) + xlab("Year")
fig_timetrend$values
fig_timetrend <- plot_timetrend(dynamic_out, show_topic = c(1:14), time_index_label = abstracts$year, xlab = "Year")
fig_timetrend
fig_timetrend$values <- fig_timetrend$values %>%
mutate(Topic = case_when(
Topic =="1_Extractives" ~ "Topic 1: Extractives",
Topic =="2_Renewables" ~ "Topic 2: Renewables",
Topic =="3_Climate" ~ "Topic 3: Climate",
Topic =="4_Health" ~ "Topic 4: Health",
Topic =="Other_1" ~ "Topic 5: Social Reform",
Topic =="Other_2" ~ "Topic 6: Infrastructure",
Topic =="Other_3" ~ "Topic 7: Urban and Rural Development",
Topic =="Other_4" ~ "Topic 8: Nutrition",
Topic =="Other_5" ~ "Topic 9: Public Management",
Topic =="Other_6" ~ "Topic 10: Education",
Topic =="Other_7" ~ "Topic 11: Statistical Capacity",
Topic =="Other_8" ~ "Topic 12: Private Sector",
Topic =="Other_9" ~ "Topic 13: Fiscal Reforms",
Topic =="Other_10" ~ "Topic 14: Credit Policies",
.default = Topic)
) %>%
mutate(Topic = factor(Topic, levels = c(
"Topic 1: Extractives",
"Topic 2: Renewables",
"Topic 3: Climate",
"Topic 4: Health",
"Topic 5: Social Reform",
"Topic 6: Infrastructure",
"Topic 7: Urban and Rural Development",
"Topic 8: Nutrition",
"Topic 9: Public Management",
"Topic 10: Education",
"Topic 11: Statistical Capacity",
"Topic 12: Private Sector",
"Topic 13: Fiscal Reforms",
"Topic 14: Credit Policies"
)))
fig_timetrend$values
ggplot(fig_timetrend$values, aes(x = time_index, y = Point)) + geom_line(linewidth = 1, color = "#0f00b3") + facet_wrap("Topic", nrow = 5) +
geom_ribbon(aes(ymin = Lower, ymax = Upper), fill = "#9e9e9e", alpha = 0.4) +
scale_y_continuous(expand = c(0, 0), limits = c(0, NA)) +
theme_classic() + theme(strip.text = element_text(face = "bold")) +
annotate('rect', xmin=2020, xmax=Inf, ymin=0, ymax=Inf, alpha=.2, fill='grey') +
ylab(expression("Mean of " * theta)) + xlab("Year")
ggsave("figures/fig_D2_prevalence.pdf", width = 6, height = 10)
ggsave("figures/fig_D2_prevalence.pdf", width = 8, height = 10)
ggsave("figures/fig_D2_prevalence.pdf", width = 9, height = 10)
ggplot(fig_timetrend$values, aes(x = time_index, y = Point)) + geom_line(linewidth = 1, color = "#0f00b3") + facet_wrap("Topic", nrow = 5) +
# geom_ribbon(aes(ymin = Lower, ymax = Upper), fill = "#9e9e9e", alpha = 0.4) +
scale_y_continuous(expand = c(0, 0), limits = c(0, NA)) +
theme_classic() + theme(strip.text = element_text(face = "bold")) +
annotate('rect', xmin=2020, xmax=Inf, ymin=0, ymax=Inf, alpha=.2, fill='grey') +
ylab(expression("Mean of " * theta)) + xlab("Year")
ggplot(fig_timetrend$values, aes(x = time_index, y = Point)) + geom_line(linewidth = 1, color = "#0f00b3") + facet_wrap("Topic", nrow = 5) +
geom_ribbon(aes(ymin = Lower, ymax = Upper), fill = "#9e9e9e", alpha = 0.4) +
scale_y_continuous(expand = c(0, 0), limits = c(0, NA)) +
theme_classic() + theme(strip.text = element_text(face = "bold")) +
#annotate('rect', xmin=2020, xmax=Inf, ymin=0, ymax=Inf, alpha=.2, fill='grey') +
ylab(expression("Mean of " * theta)) + xlab("Year")
ggsave("figures/fig_D2_prevalence.pdf", width = 10, height = 10)
ggplot(fig_timetrend$values, aes(x = time_index, y = Point)) + geom_line(linewidth = 1, color = "#0f00b3") + facet_wrap("Topic", nrow = 5) +
geom_ribbon(aes(ymin = Lower, ymax = Upper), fill = "#9e9e9e", alpha = 0.4) +
scale_y_continuous(expand = c(0, 0), limits = c(0, NA)) +
theme_classic() + theme(strip.text = element_text(face = "bold"), axis.text = element_text(size = 10)) +
#annotate('rect', xmin=2020, xmax=Inf, ymin=0, ymax=Inf, alpha=.2, fill='grey') +
ylab(expression("Mean of " * theta)) + xlab("Year")
ggplot(fig_timetrend$values, aes(x = time_index, y = Point)) + geom_line(linewidth = 1, color = "#0f00b3") + facet_wrap("Topic", nrow = 5) +
geom_ribbon(aes(ymin = Lower, ymax = Upper), fill = "#9e9e9e", alpha = 0.4) +
scale_y_continuous(expand = c(0, 0), limits = c(0, NA)) +
theme_classic() + theme(strip.text = element_text(face = "bold"), axis.text = element_text(size = 8)) +
#annotate('rect', xmin=2020, xmax=Inf, ymin=0, ymax=Inf, alpha=.2, fill='grey') +
ylab(expression("Mean of " * theta)) + xlab("Year")
ggsave("figures/fig_D2_prevalence.pdf", width = 10, height = 10)
ggplot(fig_timetrend$values, aes(x = time_index, y = Point)) + geom_line(linewidth = 1, color = "#0f00b3") + facet_wrap("Topic", nrow = 5) +
geom_ribbon(aes(ymin = Lower, ymax = Upper), fill = "#9e9e9e", alpha = 0.4) +
scale_y_continuous(expand = c(0, 0), limits = c(0, NA)) +
theme_classic() + theme(strip.text = element_text(face = "bold")) +
# annotate('rect', xmin=2020, xmax=Inf, ymin=0, ymax=Inf, alpha=.2, fill='grey') +
ylab(expression("Mean of " * theta)) + xlab("Year")
ggsave("figures/fig_D2_prevalence.pdf", width = 10, height = 10)
ggplot(fig_timetrend$values, aes(x = time_index, y = Point)) + geom_line(linewidth = 1, color = "#0f00b3") + facet_wrap("Topic", nrow = 5) +
geom_ribbon(aes(ymin = Lower, ymax = Upper), fill = "#9e9e9e", alpha = 0.4) +
#scale_y_continuous(expand = c(0, 0), limits = c(0, NA)) +
theme_classic() + theme(strip.text = element_text(face = "bold")) +
# annotate('rect', xmin=2020, xmax=Inf, ymin=0, ymax=Inf, alpha=.2, fill='grey') +
ylab(expression("Mean of " * theta)) + xlab("Year")
rm(fig_timetrend_main)
rm(fig_timetrend1)
save.image(file='data/dynamic_model.RData')
# to load data
library(rio)
# to manipulate data
library(tidyverse)
# to generate table with summary statistics
library(vtable)
# set wd
setwd("~/Dropbox/Book ideas/WB_paper/data/")
# load data
total_ida_ibrd_commitment <- import("data/abstracts_with_proportions.csv") %>%
filter(year>2000 & year<2023) %>%
group_by(year) %>%
summarise(ida_ibrd_commitment_2023usd_total = sum(ida_ibrd_commitment_2023usd)) %>%
ungroup()
# set wd
setwd("~/Dropbox/Book ideas/WB_paper/")
# load data
total_ida_ibrd_commitment <- import("data/abstracts_with_proportions.csv") %>%
filter(year>2000 & year<2023) %>%
group_by(year) %>%
summarise(ida_ibrd_commitment_2023usd_total = sum(ida_ibrd_commitment_2023usd)) %>%
ungroup()
full_data <- import("abstracts_with_proportions.csv") %>%
filter(year>2000 & year<2023) %>%
mutate(health_theme_percentage = ifelse(health_theme_percentage > 100, 100, health_theme_percentage),
climate_theme_percentage = ifelse(climate_theme_percentage > 100, 100, climate_theme_percentage),
proportion_health = proportion_health*100,
proportion_extractives = proportion_extractives*100,
proportion_renewables = proportion_renewables*100,
proportion_climate = proportion_climate*100,
log_population_lag = log(population_lag),
# generate funding variables
extractive_sector_2023usd = extractive_sector_percentage/100*ida_ibrd_commitment_2023usd,
renewable_sector_2023usd = renewable_sector_percentage/100*ida_ibrd_commitment_2023usd,
health_sector_2023usd = health_sector_percentage/100*ida_ibrd_commitment_2023usd,
climate_theme_2023usd = climate_theme_percentage/100*ida_ibrd_commitment_2023usd,
health_theme_2023usd = health_theme_percentage/100*ida_ibrd_commitment_2023usd,
extractive_topic_2023usd = proportion_extractives*ida_ibrd_commitment_2023usd,
renewable_topic_2023usd = proportion_renewables*ida_ibrd_commitment_2023usd,
climate_topic_2023usd = proportion_climate*ida_ibrd_commitment_2023usd,
health_topic_2023usd = proportion_health*ida_ibrd_commitment_2023usd
) %>%
mutate(across(extractive_sector_2023usd:health_topic_2023usd,
~ ifelse(.x > 0, log(.x), log(.x + 1)),
.names = "log_{.col}")) %>%
left_join(total_ida_ibrd_commitment) %>%
# generate funding variables
mutate(extractive_sector_percentage = extractive_sector_2023usd*100/ida_ibrd_commitment_2023usd_total,
renewable_sector_percentage = renewable_sector_2023usd*100/ida_ibrd_commitment_2023usd_total,
health_sector_percentage = health_sector_2023usd*100/ida_ibrd_commitment_2023usd_total,
climate_theme_percentage = climate_theme_2023usd*100/ida_ibrd_commitment_2023usd_total,
health_theme_percentage = health_theme_2023usd*100/ida_ibrd_commitment_2023usd_total,
extractive_topic_percentage = extractive_topic_2023usd*100/ida_ibrd_commitment_2023usd_total,
renewable_topic_percentage = renewable_topic_2023usd*100/ida_ibrd_commitment_2023usd_total,
climate_topic_percentage = climate_topic_2023usd*100/ida_ibrd_commitment_2023usd_total,
health_topic_percentage = health_topic_2023usd*100/ida_ibrd_commitment_2023usd_total
)
full_data <- import("data/abstracts_with_proportions.csv") %>%
filter(year>2000 & year<2023) %>%
mutate(health_theme_percentage = ifelse(health_theme_percentage > 100, 100, health_theme_percentage),
climate_theme_percentage = ifelse(climate_theme_percentage > 100, 100, climate_theme_percentage),
proportion_health = proportion_health*100,
proportion_extractives = proportion_extractives*100,
proportion_renewables = proportion_renewables*100,
proportion_climate = proportion_climate*100,
log_population_lag = log(population_lag),
# generate funding variables
extractive_sector_2023usd = extractive_sector_percentage/100*ida_ibrd_commitment_2023usd,
renewable_sector_2023usd = renewable_sector_percentage/100*ida_ibrd_commitment_2023usd,
health_sector_2023usd = health_sector_percentage/100*ida_ibrd_commitment_2023usd,
climate_theme_2023usd = climate_theme_percentage/100*ida_ibrd_commitment_2023usd,
health_theme_2023usd = health_theme_percentage/100*ida_ibrd_commitment_2023usd,
extractive_topic_2023usd = proportion_extractives*ida_ibrd_commitment_2023usd,
renewable_topic_2023usd = proportion_renewables*ida_ibrd_commitment_2023usd,
climate_topic_2023usd = proportion_climate*ida_ibrd_commitment_2023usd,
health_topic_2023usd = proportion_health*ida_ibrd_commitment_2023usd
) %>%
mutate(across(extractive_sector_2023usd:health_topic_2023usd,
~ ifelse(.x > 0, log(.x), log(.x + 1)),
.names = "log_{.col}")) %>%
left_join(total_ida_ibrd_commitment) %>%
# generate funding variables
mutate(extractive_sector_percentage = extractive_sector_2023usd*100/ida_ibrd_commitment_2023usd_total,
renewable_sector_percentage = renewable_sector_2023usd*100/ida_ibrd_commitment_2023usd_total,
health_sector_percentage = health_sector_2023usd*100/ida_ibrd_commitment_2023usd_total,
climate_theme_percentage = climate_theme_2023usd*100/ida_ibrd_commitment_2023usd_total,
health_theme_percentage = health_theme_2023usd*100/ida_ibrd_commitment_2023usd_total,
extractive_topic_percentage = extractive_topic_2023usd*100/ida_ibrd_commitment_2023usd_total,
renewable_topic_percentage = renewable_topic_2023usd*100/ida_ibrd_commitment_2023usd_total,
climate_topic_percentage = climate_topic_2023usd*100/ida_ibrd_commitment_2023usd_total,
health_topic_percentage = health_topic_2023usd*100/ida_ibrd_commitment_2023usd_total
)
full_data %>%
dplyr::select(extractive_sector_percentage,proportion_extractives,
renewable_sector_percentage,proportion_renewables,
climate_theme_percentage,proportion_climate,
health_sector_percentage,health_theme_percentage,proportion_health,
extractive_sector_percentage_total,extractive_topic_percentage_total,
renewable_sector_percentage_total,renewable_topic_percentage_total,
climate_theme_percentage_total,climate_topic_percentage_total,
health_sector_percentage_total,health_theme_percentage_total,health_sector_percentage_total,
governance_average_lag,any_election_lag,
eiti_member_lag, field_discovery_lag, sids, disaster_lag,
log_population_lag, log_gdp_pc_lag, log_nat_res_rents_lag,
oda_dac_lag, chinese_aid_new_commitments_usd_lag,
imf_program_lag, unsc_member_lag, us_ideal_point_agreement_lag) %>%
mutate(across(c(sector_health_main,theme_health_main,
sector_extractive_main,sector_renewable_main,
theme_climate_main,theme_climate_any,after_2019,any_election_lag,
eiti_member_lag, field_discovery_lag, sids, disaster_lag,imf_program_lag, unsc_member_lag), as.factor))
full_data <- import("data/abstracts_with_proportions.csv") %>%
filter(year>2000 & year<2023) %>%
mutate(health_theme_percentage = ifelse(health_theme_percentage > 100, 100, health_theme_percentage),
climate_theme_percentage = ifelse(climate_theme_percentage > 100, 100, climate_theme_percentage),
proportion_health = proportion_health*100,
proportion_extractives = proportion_extractives*100,
proportion_renewables = proportion_renewables*100,
proportion_climate = proportion_climate*100,
log_population_lag = log(population_lag),
# generate funding variables
extractive_sector_2023usd = extractive_sector_percentage/100*ida_ibrd_commitment_2023usd,
renewable_sector_2023usd = renewable_sector_percentage/100*ida_ibrd_commitment_2023usd,
health_sector_2023usd = health_sector_percentage/100*ida_ibrd_commitment_2023usd,
climate_theme_2023usd = climate_theme_percentage/100*ida_ibrd_commitment_2023usd,
health_theme_2023usd = health_theme_percentage/100*ida_ibrd_commitment_2023usd,
extractive_topic_2023usd = proportion_extractives*ida_ibrd_commitment_2023usd,
renewable_topic_2023usd = proportion_renewables*ida_ibrd_commitment_2023usd,
climate_topic_2023usd = proportion_climate*ida_ibrd_commitment_2023usd,
health_topic_2023usd = proportion_health*ida_ibrd_commitment_2023usd
) %>%
mutate(across(extractive_sector_2023usd:health_topic_2023usd,
~ ifelse(.x > 0, log(.x), log(.x + 1)),
.names = "log_{.col}")) %>%
left_join(total_ida_ibrd_commitment) %>%
# generate funding variables
mutate(extractive_sector_percentage_total = extractive_sector_2023usd*100/ida_ibrd_commitment_2023usd_total,
renewable_sector_percentage_total = renewable_sector_2023usd*100/ida_ibrd_commitment_2023usd_total,
health_sector_percentage_total = health_sector_2023usd*100/ida_ibrd_commitment_2023usd_total,
climate_theme_percentage_total = climate_theme_2023usd*100/ida_ibrd_commitment_2023usd_total,
health_theme_percentage_total = health_theme_2023usd*100/ida_ibrd_commitment_2023usd_total,
extractive_topic_percentage_total = extractive_topic_2023usd*100/ida_ibrd_commitment_2023usd_total,
renewable_topic_percentage_total = renewable_topic_2023usd*100/ida_ibrd_commitment_2023usd_total,
climate_topic_percentage_total = climate_topic_2023usd*100/ida_ibrd_commitment_2023usd_total,
health_topic_percentage_total = health_topic_2023usd*100/ida_ibrd_commitment_2023usd_total
)
full_data %>%
dplyr::select(extractive_sector_percentage,proportion_extractives,
renewable_sector_percentage,proportion_renewables,
climate_theme_percentage,proportion_climate,
health_sector_percentage,health_theme_percentage,proportion_health,
extractive_sector_percentage_total,extractive_topic_percentage_total,
renewable_sector_percentage_total,renewable_topic_percentage_total,
climate_theme_percentage_total,climate_topic_percentage_total,
health_sector_percentage_total,health_theme_percentage_total,health_sector_percentage_total,
governance_average_lag,any_election_lag,
eiti_member_lag, field_discovery_lag, sids, disaster_lag,
log_population_lag, log_gdp_pc_lag, log_nat_res_rents_lag,
oda_dac_lag, chinese_aid_new_commitments_usd_lag,
imf_program_lag, unsc_member_lag, us_ideal_point_agreement_lag) %>%
mutate(across(c(sector_health_main,theme_health_main,
sector_extractive_main,sector_renewable_main,
theme_climate_main,theme_climate_any,after_2019,any_election_lag,
eiti_member_lag, field_discovery_lag, sids, disaster_lag,imf_program_lag, unsc_member_lag), as.factor))
full_data %>%
dplyr::select(extractive_sector_percentage,proportion_extractives,
renewable_sector_percentage,proportion_renewables,
climate_theme_percentage,proportion_climate,
health_sector_percentage,health_theme_percentage,proportion_health,
extractive_sector_percentage_total,extractive_topic_percentage_total,
renewable_sector_percentage_total,renewable_topic_percentage_total,
climate_theme_percentage_total,climate_topic_percentage_total,
health_sector_percentage_total,health_theme_percentage_total,health_sector_percentage_total,
governance_average_lag,any_election_lag,
eiti_member_lag, field_discovery_lag, sids, disaster_lag,
log_population_lag, log_gdp_pc_lag, log_nat_res_rents_lag,
oda_dac_lag, chinese_aid_new_commitments_usd_lag,
imf_program_lag, unsc_member_lag, us_ideal_point_agreement_lag) %>%
mutate(across(c(any_election_lag,
eiti_member_lag, field_discovery_lag, sids, disaster_lag,imf_program_lag, unsc_member_lag), as.factor))
